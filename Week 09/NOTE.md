# 学习笔记

CSS 计算

## 收集 CSS 规则
* 遇到 style 标签，把 css 规则保存起来。
* 调用 CSS parser 分析 CSS 规则。
* 这里我们要研究此库分析 CSS 规则的格式。

## 添加调用
* 当我们创建一个元素时，立即计算 CSS。
* 理论上，当我们遇到一个元素时，CSS 规则已经收集完。
* 在真实的浏览器中，遇到 body 里的 style 标签时，需要重新计算 CSS，这里忽略。

## 获取父元素序列
* 必须知道该元素所有的父元素，才能知道是否与规则匹配
* 从上一步骤的 stack 中，可以获取所有的父元素
* 因为我们最先匹配的是当前元素，所以父元素的获取与匹配是从内往外的
  
## 选择器与父元素的匹配
* 选择器也从内向外排序
* 复杂选择器拆成针对单个元素的选择器，通过循环匹配父元素队列

## 选择器与父元素匹配的 match 函数
* 根据选择器的类型和元素属性，计算是否匹配
* 仅仅实现了三种基础选择器
  
## 生成 computedStyle
* 一旦选择匹配，就应用选择器到元素上，生成 computedStyle

## specification(优先级)的计算逻辑
* CSS 规则根据 specificity 和后来者优先规则覆盖。
* spcificity 是一个四元组，越左边权重越高。
* 一个 CSS 规则的 specificity 根据包含的简单选择器相加而成。
